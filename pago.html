<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pago</title>
  <link rel="stylesheet" href="./styles-pago.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
</head>
<body>
    <div class="wrapper">
        <div class="container">
            <form action="index.html" method="get">
                <h1>
                    <i class="fas fa-shipping-fast"></i>
                    Detalles de envio
                </h1>
                <div class="name">
                    <div>
                        <label for="f-name">Nombre</label>
                        <input type="text" name="f-name" placeholder="Mario Zapata" oninput="validarNombre(this)" maxlength="20" pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Por favor, ingrese solo letras y minimo un nombre y apellido" required>
                    </div>
                    <div>
                        <label for="l-name">Rut</label>
                        <input type="text" name="rut" placeholder="127849554" oninput="formatoYValidacionRut(this)" maxlength="12" required>
                    </div>
                    
                </div>
                <div class="street">
                    <div><label for="name">Calle</label>
                        <input type="text" name="address" placeholder="Paicavi" oninput="validarCalle(this)" maxlength="20" pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Por favor, ingrese solo letras" required>
                    </div>
                    <div>
                        <label for="name">Numero de casa</label>
                        <input type="text" name="number" placeholder="322" oninput="validarNumeroCasa(this)" maxlength="5" pattern="[0-9]+" title="Por favor, ingrese solo números" required>
                    
                    </div>
                    
                </div>
                <div class="address-info">
                    <div>
                        <label for="city">Ciudad</label>
                        <input type="text" name="city" placeholder="Concepcion" oninput="validarCiudad(this)" maxlength="20" pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Por favor, ingrese solo letras" required>
                    </div>
                    <div>
                        <label for="state">Región</label>
                        <input type="text" name="state" placeholder="Bio Bio" oninput="validarRegion(this)" maxlength="20" pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Por favor, ingrese solo letras" required>
                    </div>
                    <div>
                        <label for="zip">Código Postal</label>
                        <input type="text" name="zip" placeholder="4030000" oninput="validarCodigoPostal(this)" maxlength="10" pattern="[0-9]+" title="Por favor, ingrese solo números" required>
                    </div>
                </div>
                <h1>
                    <i class="far fa-credit-card"></i> Informacion de pago
                </h1>
                <div class="cc-num">
                    <label for="card-num">Número de tarjeta</label>
                    <input type="text" name="card-num" placeholder="1111222233334444" oninput="validarNumeroTarjeta(this)" maxlength="16" pattern="[0-9]+" title="Por favor, ingrese solo números" required>
                </div>
                <div class="cc-info">
                    <div>
                        <label for="expire">Fecha de expiración</label>
                        <input type="text" name="expire" placeholder="04/27" oninput="formatearYValidarFechaExpiracion(this)" maxlength="5" pattern="(0[1-9]|1[0-2])\/(\d{2})" title="Por favor, ingrese una fecha válida en formato MM/YY" required>
                    </div>
                    <div>
                        <label for="security">CCV</label>
                        <input type="text" name="security" placeholder="331" oninput="validarCCV(this)" maxlength="3" pattern="[0-9]{3}" title="Por favor, ingrese un CCV válido de 3 dígitos" required>
                    </div>
                </div>
                <div class="btns">
                    <button>Comprar</button>
                    <button onclick="window.location.href='carrito.html'; return false;">Volver al carrito</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="modalCompraExitosa" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Compra Exitosa</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              ¡Su compra se ha realizado con éxito!
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>

      <script>
        // Obtener el formulario
        var form = document.querySelector('form');
      
        // Agregar un evento de escucha para cuando se envíe el formulario
        form.addEventListener('submit', function(event) {
          // Evitar que se envíe el formulario de forma predeterminada
          event.preventDefault();
      
          // Mostrar el modal de compra exitosa
          var modal = new bootstrap.Modal(document.getElementById('modalCompraExitosa'));
          modal.show();
      
          // Redirigir al index después de 3 segundos
          setTimeout(function() {
            window.location.href = 'index.html';
          }, 3000);
        });
      </script>
      

    <script>
        function validarNombre(input) {
            // Obtener el valor del input
            var nombre = input.value;
        
            // Verificar si el nombre contiene al menos un espacio
            var espacios = nombre.split(' ').length - 1;
            if (espacios < 1 || espacios > 2) {
                // Si no hay espacios o hay más de dos espacios (más de un apellido), establecer un error personalizado
                input.setCustomValidity('Debe ingresar un nombre y uno o dos apellidos');
            } else {
                // Si hay al menos un espacio (nombre y al menos un apellido), borrar el error personalizado
                input.setCustomValidity('');
            }
        
            // Aplicar la expresión regular para permitir solo letras y espacios
            input.value = input.value.replace(/[^A-Za-záéíóúÁÉÍÓÚñÑ\s]/g, '');
        }
        </script>

    <script>
        function formatoYValidacionRut(input) {
            // Obtener el valor del input sin espacios ni caracteres especiales
            var rut = input.value.replace(/[^\dKk]/g, '');
        
            // Agregar puntos y guión de acuerdo al formato rut (xx.xxx.xxx-x)
            rut = rut.replace(/^(\d{2})(\d{3})(\d{3})(\w{1})$/, '$1.$2.$3-$4');
        
            // Actualizar el valor del input con el formato
            input.value = rut;
        
            // Validar el rut
            if (!validarRut(rut)) {
                input.setCustomValidity('El rut ingresado no es válido');
            } else {
                input.setCustomValidity('');
            }
        }
        
        function validarRut(rut) {
    // Expresión regular para validar el Rut chileno
    var rutRegex = /^(\d{1,2}\.)?(\d{3}\.)?\d{3}-[\dkK]$/;

    // Validar el Rut utilizando la expresión regular
    if (rutRegex.test(rut)) {
        return true; // El Rut es válido
    } else {
        return false; // El Rut no es válido
    }
}
        </script>

<script>
    function validarCalle(input) {
        // Aplicar la expresión regular para permitir solo letras y espacios
        input.value = input.value.replace(/[^A-Za-záéíóúÁÉÍÓÚñÑ\s]/g, '');
    }
    
    function validarNumeroCasa(input) {
        // Aplicar la expresión regular para permitir solo números
        input.value = input.value.replace(/[^0-9]/g, '');
    }
    </script>

<script>
    function validarCiudad(input) {
        // Aplicar la expresión regular para permitir solo letras y espacios
        input.value = input.value.replace(/[^A-Za-záéíóúÁÉÍÓÚñÑ\s]/g, '');
    }
    
    function validarRegion(input) {
        // Aplicar la expresión regular para permitir solo letras y espacios
        input.value = input.value.replace(/[^A-Za-záéíóúÁÉÍÓÚñÑ\s]/g, '');
    }
    
    function validarCodigoPostal(input) {
        // Aplicar la expresión regular para permitir solo números
        input.value = input.value.replace(/[^0-9]/g, '');
    }
    </script>

<script>
    function validarNumeroTarjeta(input) {
        // Aplicar la expresión regular para permitir solo números
        input.value = input.value.replace(/[^0-9]/g, '');
    }
    
    
    function validarCCV(input) {
        // Aplicar la expresión regular para permitir solo números
        input.value = input.value.replace(/[^0-9]/g, '');
    }
    </script>

<script>
    function formatearYValidarFechaExpiracion(input) {
        // Obtener el valor del input sin espacios ni caracteres especiales
        var fecha = input.value.replace(/[^\d/]/g, '');
    
        // Eliminar el último '/' si se ingresó accidentalmente
        if (fecha.length > 3) {
            fecha = fecha.slice(0, 2) + '/' + fecha.slice(2);
        }
    
        // Actualizar el valor del input con el formato MM/YY
        input.value = fecha;
    
        // Validar el formato de la fecha
        if (!validarFormatoFecha(fecha)) {
            input.setCustomValidity('Por favor, ingrese una fecha válida en formato MM/YY');
        } else {
            input.setCustomValidity('');
        }
    }
    
    function validarFormatoFecha(fecha) {
        // Expresión regular para validar el formato MM/YY
        var regexFecha = /^(0[1-9]|1[0-2])\/(\d{2})$/;
    
        // Validar el formato utilizando la expresión regular
        return regexFecha.test(fecha);
    }
    </script>
</body>
</html>
